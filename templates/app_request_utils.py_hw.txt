<p>
This module handles the functions for requests to:
</p>
<ul>
<li>
Create a new FOIL Request and associated Users, UserRequests, and Events.
</li>
<li>
Get mailing address from form data.
</li>
<li>
Try to store and scan an uploaded file when no request id has been generated.
</li>
<li>
Save an upload file to the quarantine directory, with this directory being the
file's immediate parent.
</li>
<li>
Move an approved upload to the upload directory.
</li>
<li>
Generates an agency-specific FOIL request id.
</li>
<li>
Generate HTML for rich-text emails.
</li>
<li>
Generates a GUID for an anonymous user.
</li>
<li>
Sends out a confirmation email to requester and bcc the agency default email
associated with the request.
</li>
<li>
Creates user_requests entries for agency administrators.
</li>
<li>
Creates Users, Emails, and Events entries for a contact submission for a
request.
Sends email with message to all agency users associated with the request.
</li>
</ul>

<h3>
Code Issues
</h3>

	<ul class="review">
		<li>
			The function <code>create_request</code> is over 200 lines long.
			It should be broken up into smaller functions for readability
			and unit testing.
			The numbered comments are the logical places to break up the code:
			turn each numbered comment into a function call.
		</li>

		<li>
			In the following code, the same call is being made in the
			<code>if</code> and the <code>else</code> with slightly different parameters:
			<pre>
			<code>
        if requester_email:
            safely_send_and_add_email(
                request.id,
                email_content,
                subject,
                to=[requester_email],
                bcc=bcc,
            )
        # otherwise send the email directly to the agency
        else:
            safely_send_and_add_email(
                request.id,
                email_content,
                subject,
                to=[agency.default_email],
            )

			</code>
			</pre>
			Instead, the parameters should be set in the <code>if</code>
			and the <code>else</code>, then the call made in one place.
		</li>

		<li>
			For the following line:
			<pre>
			<code>
				body = "Name: {} {}\n\nEmail: {}\n\nSubject: {}\n\nMessage:\n{}".format(
			</code>
			</pre>
			a constant string should be defined, to increase re-usability and ease possible
			ports to other languages.
		</li>

	</ul>


<h3>
Code Check Report
</h3>

<p>
	This was created by running <code>flake8</code> against the code in this file.
</p>

<pre>
utils.py:16:80: E501 line too long (81 &gt; 79 characters)
utils.py:41:1: F401 'app.lib.date_utils.get_following_date' imported but unused
utils.py:41:1: F401 'app.lib.date_utils.is_business_day' imported but unused
utils.py:114:80: E501 line too long (97 &gt; 79 characters)
utils.py:127:80: E501 line too long (105 &gt; 79 characters)
utils.py:151:80: E501 line too long (81 &gt; 79 characters)
utils.py:220:80: E501 line too long (91 &gt; 79 characters)
utils.py:250:80: E501 line too long (80 &gt; 79 characters)
utils.py:255:80: E501 line too long (111 &gt; 79 characters)
utils.py:265:80: E501 line too long (98 &gt; 79 characters)
utils.py:270:80: E501 line too long (84 &gt; 79 characters)
utils.py:273:80: E501 line too long (82 &gt; 79 characters)
utils.py:365:80: E501 line too long (83 &gt; 79 characters)
utils.py:381:80: E501 line too long (95 &gt; 79 characters)
utils.py:385:80: E501 line too long (87 &gt; 79 characters)
utils.py:387:80: E501 line too long (135 &gt; 79 characters)
utils.py:390:80: E501 line too long (83 &gt; 79 characters)
utils.py:423:80: E501 line too long (109 &gt; 79 characters)
utils.py:424:80: E501 line too long (93 &gt; 79 characters)
utils.py:443:80: E501 line too long (96 &gt; 79 characters)
utils.py:452:80: E501 line too long (94 &gt; 79 characters)
utils.py:462:80: E501 line too long (104 &gt; 79 characters)
utils.py:466:80: E501 line too long (85 &gt; 79 characters)
utils.py:467:80: E501 line too long (97 &gt; 79 characters)
utils.py:468:80: E501 line too long (95 &gt; 79 characters)
utils.py:473:80: E501 line too long (90 &gt; 79 characters)
utils.py:482:80: E501 line too long (94 &gt; 79 characters)
utils.py:483:80: E501 line too long (96 &gt; 79 characters)
utils.py:486:80: E501 line too long (87 &gt; 79 characters)
utils.py:525:80: E501 line too long (84 &gt; 79 characters)
utils.py:538:80: E501 line too long (83 &gt; 79 characters)
utils.py:540:80: E501 line too long (85 &gt; 79 characters)
utils.py:579:80: E501 line too long (90 &gt; 79 characters)
</pre>
